---
import { languages, getAlternateLang, getAlternateSlug, t, type Lang } from '../i18n/config';
import ThemeToggle from './ThemeToggle.astro';

interface Props {
  lang: Lang;
  currentSlug?: string;
  hideTitle?: boolean;
  tagline?: string;
}

const { lang, currentSlug = '', hideTitle = false, tagline } = Astro.props;
const alternateLang = getAlternateLang(lang);
const alternateSlug = getAlternateSlug(lang, currentSlug);
const bookTitle = languages[lang].bookTitle;

// Build alternate URL (will be absolute domain in production)
const alternateUrl = `/${alternateLang}/${alternateSlug}`;
---

<header class="sticky top-0 z-40 bg-stone-50/95 dark:bg-stone-950/95 backdrop-blur border-b border-stone-200 dark:border-stone-800">
  <div class="px-4 sm:px-6 lg:px-8 py-4 max-w-3xl mx-auto flex items-center justify-between">
    <!-- Book Title (hidden on mobile, visible on larger screens, hidden if hideTitle is true) -->
    {!hideTitle && (
      <a href={`/${lang}/introduction`} class="hidden sm:block text-lg font-medium font-sans text-stone-700 dark:text-stone-300 hover:text-stone-900 dark:hover:text-stone-100 transition-colors">
        {bookTitle}
      </a>
    )}
    {hideTitle && tagline && (
      <span class="hidden sm:block text-base font-sans italic text-stone-600 dark:text-stone-400">
        {tagline}
      </span>
    )}
    {hideTitle && !tagline && <div class="hidden sm:block"></div>}

    <!-- Mobile: Menu Button -->
    <button
      data-menu-toggle
      class="lg:hidden p-2 -ml-2 text-stone-600 dark:text-stone-400 hover:text-stone-900 dark:hover:text-stone-100"
      aria-label={t(lang, 'menu.open')}
    >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
      </svg>
    </button>

    <!-- Right side: Language Switch + Theme Toggle -->
    <div class="flex items-center gap-3">
      <!-- Language Switcher -->
      <a
        href={alternateUrl}
        class="px-3 py-1.5 text-sm font-sans font-medium rounded-md border border-stone-300 dark:border-stone-700 text-stone-600 dark:text-stone-400 hover:bg-stone-100 dark:hover:bg-stone-800 transition-colors"
      >
        {languages[alternateLang].name}
      </a>

      <!-- Theme Toggle -->
      <ThemeToggle lang={lang} />
    </div>
  </div>
</header>
